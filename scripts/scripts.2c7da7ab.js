!function(){"use strict";function a(a,b){a.state("main",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"ctrl",data:{requiredLogin:!0}}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl",controllerAs:"ctrl"}).state("userPosts",{url:"/myposts",templateUrl:"views/user-posts.html",controller:"UserPostsCtrl",controllerAs:"ctrl",data:{requiredLogin:!0}}).state("profile",{url:"/profile",templateUrl:"views/profile.html",controller:"ProfileCtrl",controllerAs:"ctrl",data:{requiredLogin:!0}}).state("post",{url:"/post/:id",templateUrl:"views/post.html",controller:"PostCtrl",controllerAs:"ctrl",data:{requiredLogin:!0}}).state("about",{url:"/about",templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"ctrl"}),b.otherwise("/")}function b(a,b,c){a.$state=b,a.currentUser=c.getUser(),a.$on("$stateChangeStart",function(a,d){var e=!1;d.data&&d.data.requiredLogin&&(e=!0),e&&!c.isAuthenticated()&&(a.preventDefault(),b.go("login"))})}angular.module("muralApp",["ngAnimate","ngCookies","ngResource","ui.router","jcs-autoValidate"]).constant("RESTAPI",{url:"https://jsonplaceholder.typicode.com/"}).config(a).run(b),a.$inject=["$stateProvider","$urlRouterProvider"],b.$inject=["$rootScope","$state","Auth"]}(),function(){"use strict";function a(a,b,c){function d(){a.query(function(a){f.posts=a,f.posts.comments=[]})}function e(b){a.comments({id:b.id},function(a){})}var f=this;f.posts=[],f.getComments=e,d()}angular.module("muralApp").controller("MainCtrl",a),a.$inject=["Posts","Auth","$state"]}(),function(){"use strict";function a(a,b){function c(){var c=b.getUser();i.isLoading=!0,a.userPosts({id:c.id},function(b){var c=b;i.totalPosts=c.length,c.forEach(function(b){a.comments({id:b.id},function(a){b.totalComments=a.length+(Math.floor(9*Math.random())+1),b.comments=a,b.isNew=!1,i.isLoading=!1,i.posts.push(b)})})}),h()}function d(a){var b=angular.copy(i.newPost);b.comments=[],i.posts.push(b),i.totalPosts=i.posts.length,h(a)}function e(a){return a.id===i.selectedPost.id}function f(a){i.selectedPost=a}function g(a){e(a)?i.selectedPost={}:f(a)}function h(a){a&&(a.$setPristine(),a.$setUntouched()),i.newPost={title:"",body:"",totalComments:0,comments:[],isNew:!0},$("#newPostDialog").modal("hide")}var i=this;i.posts=[],i.newPost={},i.totalPosts=0,i.selectedPost={},i.isLoading=!1,i.createNewPost=d,i.isSelected=e,i.selectPost=f,i.toggleComments=g,c()}angular.module("muralApp").controller("UserPostsCtrl",a),a.$inject=["Posts","Auth"]}(),function(){"use strict";function a(a,b,c){function d(){e.formError=!1,e.isLoading=!0,c.authenticate(e.username,function(){a.go("userPosts")},function(){console.log("Auth error"),e.isLoading=!1,b(function(){e.formError=!0},500)})}var e=this;e.username="",e.formError=!1,e.isLoading=!1,e.doLogin=d}angular.module("muralApp").controller("LoginCtrl",a),a.$inject=["$state","$timeout","Auth"]}(),function(){"use strict";function a(a,b){var c=this;c.post=a.get({id:b.id},function(){c.post.comments=a.comments({id:b.id})})}angular.module("muralApp").controller("PostCtrl",a),a.$inject=["Posts","$stateParams"]}(),function(){"use strict";function a(a,b,c){function d(){var d=b.getUser();e.isLoading=!0,c.get({id:d.id},function(b){a(function(){e.user=b,e.isLoading=!1},2e3)})}var e=this;e.user={},e.isLoading=!1,d()}angular.module("muralApp").controller("ProfileCtrl",a),a.$inject=["$timeout","Auth","Users"]}(),angular.module("muralApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),function(){"use strict";function a(a,b,c){var d={isAuthenticated:function(){var a=b.getObject("user");return a&&a.isAuthenticated===!0},authenticate:function(d,e,f){c.query({username:d},function(c){var d=c[0];d&&d.email?(b.putObject("user",{id:d.id,name:d.name,email:d.email,username:d.username,isAuthenticated:!0}),a.currentUser=b.getObject("user"),e()):f()})},logout:function(c){b.remove("user"),a.currentUser={},c()},getUser:function(){return b.getObject("user")}};return d}angular.module("muralApp").factory("Auth",a),a.$inject=["$rootScope","$cookies","Users"]}(),function(){"use strict";function a(a,b){var c=b(a.url+"posts/:id",{id:"@id"},{comments:{method:"GET",isArray:!0,url:a.url+"posts/:id/comments"},userPosts:{method:"GET",isArray:!0,url:a.url+"posts?userId=:id"}});return c}angular.module("muralApp").factory("Posts",a),a.$inject=["RESTAPI","$resource"]}(),function(){"use strict";function a(a,b){return b(a.url+"users/:id")}angular.module("muralApp").factory("Users",a),a.$inject=["RESTAPI","$resource"]}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"views/directives/mr-navbar.html",scope:{},controller:b,controllerAs:"ctrl",bindToController:{show:"=",user:"="}}}function b(a,b){function c(){b.logout(function(){a.go("login")})}var d=this;d.doLogout=c}angular.module("muralApp").directive("mrNavbar",a),b.$inject=["$state","Auth"]}(),function(){"use strict";function a(a){return{restrict:"A",replace:!1,scope:{},link:function(b,c,d){function e(){i=20,l=0,b.timeoutId=null,m=parseInt(d.countTo)||0,b.value=parseInt(d.value,10)||0,j=1e3*parseFloat(d.duration)||0,k=Math.ceil(j/i),n=(m-b.value)/k,h=b.value}function f(){b.timeoutId=a(function(){h+=n,l++,l>=k?(a.cancel(b.timeoutId),h=m,d.value=m,o.textContent=m):(o.textContent=Math.round(h),f())},i)}function g(){b.timeoutId&&a.cancel(b.timeoutId),e(),f()}var h,i,j,k,l,m,n,o=c[0];return d.$observe("countTo",function(a){a&&g()}),d.$observe("value",function(a){g()}),!0}}}angular.module("muralApp").directive("mrCountTo",["$timeout",a])}(),angular.module("muralApp").filter("mrFirstname",function(){return function(a){var b=a.split(" ");return b[0]}}),angular.module("muralApp").run(["$templateCache",function(a){"use strict";a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/directives/mr-navbar.html",'<nav class="navbar navbar-default" ng-if="ctrl.show"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar" aria-expanded="false"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" ui-sref="main">Mural</a> </div> <div class="collapse navbar-collapse" id="main-navbar"> <ul class="nav navbar-nav"> <li ui-sref-active="active"><a ui-sref="userPosts">My posts</a></li> <li ui-sref-active="active"><a ui-sref="main">Company feed</a></li> </ul> <ul class="nav navbar-nav navbar-right"> <li ui-sref-active="active"><a ui-sref="profile">{{ctrl.user.name}}</a></li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> <span class="glyphicon glyphicon-off"></span> </a> <ul class="dropdown-menu"> <li ui-sref-active="active"><a href="" ng-click="ctrl.doLogout()">Logout</a></li> </ul> </li> </ul> </div> </div> </nav>'),a.put("views/login.html",'<div class="split-pane-flow full-height"> <div class="split-pane-left full-height"> <div class="split-flex-wrapper"> <a ui-sref="login" class="">Mural</a> <div class="login-form animated" ng-class="{\'shake\': ctrl.formError}"> <form name="loginFrm" novalidate ng-submit="ctrl.doLogin();"> <div class="form-group"> <label for="username">Your username</label> <input type="text" class="form-control input-lg" id="username" placeholder="Username" ng-model="ctrl.username" ng-minlength="3" ng-maxlength="30" required> </div> <div class="login-form-submit text-center"> <button type="submit" class="btn btn-lg btn-success" ng-disabled="loginFrm.$invalid"> <span class="glyphicon glyphicon-refresh animated infinite rotateIn" ng-show="ctrl.isLoading"></span> Sign in </button> </div> </form> </div> </div> </div> <div class="split-pane-right full-height visible-lg-block"> <div class="split-flex-wrapper"> </div> </div> </div>'),a.put("views/main.html",'<div class="content"> <div class="list-view text-container"> <div class="list-item" ng-repeat="post in ctrl.posts | orderBy:[\'-isNew\',\'-totalComments\']"> <div class="list-item-heading"> <h3 class="list-item-title">{{post.title}}</h3> </div> <div class="list-item-body"> {{post.body}} </div> <div class="list-item-footer" ng-show="post.totalComments > 0"> <div class="row"> <div class="col-xs-9"> <span class="text-muted">{{post.totalComments}} comments</span> </div> <div class="col-xs-3 text-right"> <button class="btn btn-primary btn-sm btn-block" ng-click="ctrl.toggleComments(post)"> <span class="visible-xs glyphicon glyphicon-comment"></span> <span class="hidden-xs">Show comments</span> </button> </div> </div> </div> <div class="media" ng-show="ctrl.isSelected(post)" ng-repeat="comment in post.comments"> <div class="media-left"> <img class="media-object img-circle" src="http://placehold.it/50x50" alt="user"> </div> <div class="media-body"> <span class="text-primary"><strong>{{comment.name | mrFirstname}}</strong></span> wrote: <p>{{comment.body}}</p> <a ng-href="mailto:{{comment.email}}">{{comment.email}}</a> </div> </div> </div> </div> </div>'),a.put("views/post.html",'<div class="content"> <div class="container"> <div class="panel panel-default"> <div class="panel-heading"><h3 class="panel-title">{{ctrl.post.title}}</h3></div> <div class="panel-body"> {{ctrl.post.body}} </div> <div class="panel-footer"> <div class="row"> <div class="col-xs-6"> </div> <div class="col-xs-6 text-right"> User {{ctrl.post.userId}} </div> </div> </div> </div> <div class="panel panel-default" ng-repeat="comment in ctrl.post.comments"> <div class="panel-body"> {{comment.body}} </div> <div class="panel-footer"> <div class="row"> <div class="col-xs-6"> {{comment.name}} </div> <div class="col-xs-6 text-right"> {{comment.email}} </div> </div> </div> </div> </div> </div>'),a.put("views/profile.html",'<div class="header"> <div class="container"> <div class="profile-data" ng-hide="ctrl.isLoading"> <h1>{{ctrl.user.name}} ({{ctrl.user.username}})</h1> <p class="lead">{{ctrl.user.email}}</p> <p>{{ctrl.user.address.street+ " "+ctrl.user.address.suite+", " + ctrl.user.address.city}}</p> <p>{{ctrl.user.address.zipcode}}</p> <br> <p><a ng-href="{{\'http://\'+ctrl.user.website}}" target="_blank" class="link-inverse">{{ctrl.user.website}}</a></p> <p>{{ctrl.user.phone}}</p> </div> <div class="profile-loading" ng-show="ctrl.isLoading"> <span class="glyphicon glyphicon-refresh animated infinite rotateIn"></span> Loading your profile... </div> </div> </div>'),a.put("views/user-posts.html",'<div class="header"> <div class="container"> <h1>Welcome, {{currentUser.name}}</h1> <p class="lead"> {{currentUser.email}} </p> </div> </div> <div class="content"> <div class="text-container"> <h3 class="title text-right">You wrote <span mr-count-to count-to="{{ctrl.totalPosts}}" value="0" duration="1"></span> posts</h3> </div> <div class="text-center" ng-show="ctrl.isLoading"> <span class="glyphicon glyphicon-refresh animated infinite rotateIn"></span> </div> <div class="list-view text-container"> <div class="list-item animate-repeat" ng-repeat="post in ctrl.posts | orderBy:[\'-isNew\',\'-totalComments\']"> <div class="list-item-heading"> <h3 class="list-item-title">{{post.title}}</h3> </div> <div class="list-item-body"> {{post.body}} </div> <div class="list-item-footer"> <div class="row"> <div class="col-xs-9"> <span class="text-muted">{{post.totalComments}} comments</span> </div> <div class="col-xs-3 text-right" ng-show="post.totalComments > 0"> <button class="btn btn-primary btn-sm btn-block" ng-click="ctrl.toggleComments(post)"> <span class="visible-xs glyphicon glyphicon-comment"></span> <span class="hidden-xs">Show comments</span> </button> </div> </div> </div> <div class="media" ng-show="ctrl.isSelected(post)" ng-repeat="comment in post.comments"> <div class="media-left"> <img class="media-object img-circle" src="http://placehold.it/50x50" alt="user"> </div> <div class="media-body"> <span class="text-primary"><strong>{{comment.name | mrFirstname}}</strong></span> wrote: <p>{{comment.body}}</p> <a ng-href="mailto:{{comment.email}}">{{comment.email}}</a> </div> </div> </div> </div> </div> <div class="fixed-action-btn"> <a href="" class="btn-floating" data-toggle="modal" data-target="#newPostDialog"> <span class="glyphicon glyphicon-pencil"></span> </a> </div> <div class="modal fade" id="newPostDialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"> <div class="modal-dialog" role="document"> <div class="modal-content"> <div class="list-item"> <h3>What\'s on your mind?</h3> <form name="newPostFrm" novalidate ng-submit="ctrl.createNewPost(newPostFrm);"> <div class="form-group"> <label for="title">Title</label> <input type="text" class="form-control" id="title" placeholder="My new post title" ng-model="ctrl.newPost.title" ng-minlength="3" ng-maxlength="200" required> </div> <div class="form-group"> <label for="body">Body</label> <textarea class="form-control" id="body" rows="3" placeholder="Write something..." ng-model="ctrl.newPost.body" ng-minlength="3" ng-maxlength="500" required></textarea> </div> <div class="login-form-submit text-right"> <button type="submit" class="btn btn-success" ng-disabled="newPostFrm.$invalid"> <span class="glyphicon glyphicon-refresh animated infinite rotateIn" ng-show="ctrl.isLoading"></span> Create new post </button> </div> </form> </div> </div> </div> </div>')}]);